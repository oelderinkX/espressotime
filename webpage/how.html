<!DOCTYPE html>
<html lang="en">
<head>
    <title>Espresso Time - How</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <script src="javascript/common.js"></script>
    <script>
        var hows = [];
        var filter = '';
        var canSave = false; // UPDATE CAN SAVE VIA how.jsp
    </script>
    <script>
        function displayHow() {
            var select = document.getElementById('howlist');

            for(var i = 0; i < hows.length; i++) {
                if (hows[i].id == select.value) {
                    how = hows[i];
                    break;
                }
            }
            
            var id = document.getElementById('id');
            id.value = how.id;

            var name = document.getElementById('howinput');
            name.value = how.name;

            var description = document.getElementById('description');
            description.value = how.description;
        }

        function loadHow() {
            var request = {};
            sendPost("/gethows", JSON.stringify(request), function(response) {
                hows  = JSON.parse(response);
                
                if (canSave == true) {
                    hows.push({ id: 0, name: '*** New How', description: 'Enter name and description and Save'});
                }

                hows = hows.sort((a, b) => {
                    var n1 = a.name.toUpperCase();
                    var n2 = b.name.toUpperCase();
                    if (n1 > n2) {
                        return 1;
                    } else if (n1 < n2) {
                        return - 1;
                    } else {
                        return 0;
                    }
                });

                loadHowCombo();
            });
        }

        function loadHowCombo() {
            var howlist = document.getElementById('howlist');

            howlist.innerHTML = '';

            for(var i = 0; i < hows.length; i++) {
                if (filter == '' || hows[i].name.toUpperCase().includes(filter)) {
                    var how = hows[i];
                    var option = document.createElement('option');
                    option.setAttribute('value', how.id);
                    option.innerHTML = how.name;
                    howlist.appendChild(option);
                }
            }
        }

        function saveHow() {
            var howlist = document.getElementById('howlist');
            var selectedIndex = howlist.selectedIndex;

            var id = document.getElementById('id');
            var name = document.getElementById('howinput');
            var description = document.getElementById('description');

            var how = {
                id: id.value,
                name: name.value,
                description: description.value,
            };

            sendPost("/updatehow", JSON.stringify(how), function(response) {
                loadHow();
                howlist.selectedIndex = selectedIndex;
            });
        }
    </script>

    <style>
        body {
          background-color: #ac9175;
          color: #1f1f1f !important;
          font-family: Arial, Helvetica, sans-serif;
        }
    </style>
</head>
<html>
<body>
    <button type="button" style="float:left;margin: 5px;" class="btn btn-em" onclick="window.location.href='/';">Sign in / out</button>
    <button id="tasksbutton" type="button" style="float:top;margin:15px;color:#ffffff;background-color:#000000" class="btn btn-em" onclick="window.location.href='/tasks';">Tasks</button>
    <h1>How</h1>
    <table width="100%" border=0>
        <tr>
            <td style="vertical-align:top;padding: 15px" width="200px">
                <label for="filter">Find:</label>
                <input type="text" class="form-control" id="filter" onkeyup="filter = this.value.toUpperCase(); loadHowCombo();"/>
                <br/>
                <select id="howlist" class="custom-select" size="30" style="width: 200px;" onchange="displayHow();">
                </select>
            </td>
            <td style="vertical-align:top;padding: 15px">
                <input type="hidden" id="id" value="0"/>
                <label id="howlabel" for="name">How Name:</label>
                <input id="howinput" type="text" class="form-control"/>
                <h3>Description</h3>
                <textarea rows="25" style="width:100%;" id="description"></textarea>
                <br/>
                <button id="savebutton" type="button" class="btn btn-success" onclick="saveHow();">Save</button>
            </td>
        </tr>
    </table>
</body>
<script>
    if (canSave == false)
    {
        var savebutton = document.getElementById("savebutton");
        var howlabel = document.getElementById("howlabel");
        var howinput = document.getElementById("howinput");

        savebutton.style.display = "none";
        howlabel.style.display = "none";
        howinput.style.display = "none";
    }

    loadHow();
</script>
</html>
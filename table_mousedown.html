<html>
  <style>
    th, td {
    padding: 0px;
  }
  table {
    border-spacing: 0px;
  }
  </style>
  <script>
    function save(element) {
      var start = -1;
        var end = -1;
        var employeeid = element.getAttribute('employee_id');
        var tds = document.querySelectorAll('td[employee_id="' + employeeid + '"');

        for(var i = 0; i < tds.length; i++) {
          if (start == -1) {
            if (tds[i].getAttribute('time_set') == "true") {
              start = i;
            }
          } else {
            if (tds[i].getAttribute('time_set') == "false") {
              end = i - 1;
              break;
            }
          }
        }

        var startDate = new Date();
          var endDate = new Date();

        if (start > -1 && end > -1) {
          startDate.setHours(0,0,0,0);
          startDate.setMinutes(15*start);

          endDate.setHours(0,0,0,0);
          endDate.setMinutes(15*(end+1));
        } else {
          startDate.setHours(0,0,0,0);
          startDate.setMinutes(15*start);

          endDate.setHours(0,0,0,0);
          endDate.setMinutes(15*(start+1));

          if (startDate.getDay() != endDate.getDay()) {
            endDate.setSeconds(endDate.getSeconds()-1);
          }
        }

        alert('employee (' + employeeid + ') start:' + startDate + ', end:' + endDate);
    }

    function select(element) {
      if (event.buttons > 0) {  // if we are moving the mouse over and mouse button is down
        var start = -1;
        var end = -1;
        var selected = parseInt(element.getAttribute('time_index'));
        var set = element.getAttribute('time_set');
        var employeeid = element.getAttribute('employee_id');
        var tds = document.querySelectorAll('td[employee_id="' + employeeid + '"');

        for(var i = 0; i < tds.length; i++) {
          if (start == -1) {
            if (tds[i].getAttribute('time_set') == "true") {
              start = i;
            }
          } else {
            if (tds[i].getAttribute('time_set') == "false") {
              end = i - 1;
              break;
            }
          }
        }

        if (start == -1 && end == -1) {
          element.style.backgroundColor = 'black';
          element.setAttribute('time_set', true);
        } else if (start == end && start == selected) {
          element.style.backgroundColor = 'white';
          element.setAttribute('time_set', false);
        } else {
          if (selected > start && selected > end) {
            end = selected;
          } else if (selected < start && selected < end) {
            start = selected;
          } else {
            if ((selected-start) > (end-selected)) {
              if (end == selected) {
                end--;
              } else {
                end = selected;
              }
            } else {
              if (start == selected) {
                start++;
              } else {
                start = selected;
              }
            }
          }

          for(var i = 0; i < tds.length; i++) {
            if (i >= start && i <= end) {
              tds[i].style.backgroundColor = 'black';
              tds[i].setAttribute('time_set', true);
            } else {
              tds[i].style.backgroundColor = 'white';
              tds[i].setAttribute('time_set', false);
            }
          }
        }
      }
    }

    function drawTable() {
      var table = document.getElementById('mytable');

      for(var i = 0; i < 4; i++) {
        var tr = document.createElement('tr');
        for(var x = 0; x < 96; x++) {
          var td = document.createElement('td');
          td.setAttribute('employee_id', i);
          td.setAttribute('time_index', x);
          td.setAttribute('time_set', false);
          td.draggable = false;
          td.ondragstart = function() { return false; };
          td.ondrop = function() { return false; };
          td.onmousedown = function() { select(this); return true; };
          td.onmousemove = function() { select(this); return true; };
          td.onmouseup = function() { save(this); return true; };
          tr.appendChild(td);
        }
        table.appendChild(tr);
      }
    }
  </script>
  <body>
    <table border="1" width="1400" height="300" id="mytable">
    </table>
  </body>
  <script>
     drawTable();
  </script>
</html>